<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gossip Tomography — LN Privacy Leak Detector</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace;
            background: #0a0a0f;
            color: #e0e0e0;
            overflow: hidden;
            height: 100vh;
        }

        /* Header */
        .header {
            background: linear-gradient(90deg, #0a0a0f 0%, #1a1a2e 50%, #0a0a0f 100%);
            border-bottom: 1px solid #ff6b3520;
            padding: 8px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 48px;
        }
        .header h1 {
            font-size: 16px;
            color: #ff6b35;
            letter-spacing: 2px;
        }
        .header h1 span { color: #666; font-weight: 300; }
        .header .stats {
            display: flex;
            gap: 20px;
            font-size: 11px;
            color: #888;
        }
        .header .stats .val { color: #ff6b35; font-weight: bold; }

        /* Main layout */
        .main {
            display: grid;
            grid-template-columns: 280px 1fr 320px;
            height: calc(100vh - 48px);
        }

        /* Left panel */
        .panel-left {
            background: #0d0d14;
            border-right: 1px solid #1a1a2e;
            overflow-y: auto;
            padding: 12px;
        }
        .panel-left h3 {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #ff6b35;
            margin-bottom: 8px;
        }

        /* Message picker */
        .msg-filter {
            display: flex;
            gap: 4px;
            margin-bottom: 8px;
        }
        .msg-filter button {
            flex: 1;
            padding: 4px;
            font-size: 10px;
            background: #1a1a2e;
            border: 1px solid #2a2a3e;
            color: #888;
            cursor: pointer;
            border-radius: 3px;
            font-family: inherit;
        }
        .msg-filter button.active {
            background: #ff6b3530;
            border-color: #ff6b35;
            color: #ff6b35;
        }
        .msg-list {
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 16px;
        }
        .msg-item {
            padding: 6px 8px;
            font-size: 10px;
            border-bottom: 1px solid #1a1a2e;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .msg-item:hover { background: #1a1a2e; }
        .msg-item.active { background: #ff6b3515; border-left: 2px solid #ff6b35; }
        .msg-item .type-badge {
            font-size: 8px;
            padding: 1px 4px;
            border-radius: 2px;
            text-transform: uppercase;
        }
        .type-chan_ann { background: #2a9d8f30; color: #2a9d8f; }
        .type-node_ann { background: #e9c46a30; color: #e9c46a; }
        .type-chan_upd { background: #457b9d30; color: #457b9d; }

        .msg-item .peers-count { color: #666; }

        /* Community legend */
        .community-legend { margin-bottom: 16px; }
        .community-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 10px;
            padding: 3px 0;
        }
        .community-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        /* Playback controls */
        .playback {
            margin-bottom: 16px;
            padding: 8px;
            background: #1a1a2e;
            border-radius: 4px;
        }
        .playback label {
            display: block;
            font-size: 10px;
            color: #888;
            margin-bottom: 4px;
        }
        .playback .controls {
            display: flex;
            gap: 4px;
            margin-bottom: 6px;
        }
        .playback button {
            padding: 4px 12px;
            font-size: 11px;
            background: #ff6b35;
            border: none;
            color: #fff;
            cursor: pointer;
            border-radius: 3px;
            font-family: inherit;
        }
        .playback button:hover { background: #ff8555; }
        .playback button.secondary {
            background: #2a2a3e;
            color: #aaa;
        }
        .playback input[type="range"] {
            width: 100%;
            margin-top: 4px;
        }
        .playback .time-display {
            font-size: 18px;
            color: #ff6b35;
            text-align: center;
            padding: 4px 0;
        }
        .progress-bar {
            width: 100%;
            height: 4px;
            background: #2a2a3e;
            border-radius: 2px;
            margin-top: 6px;
            overflow: hidden;
        }
        .progress-bar .fill {
            height: 100%;
            background: #ff6b35;
            width: 0%;
            transition: width 0.1s linear;
        }

        /* Center — visualization area */
        .panel-center {
            position: relative;
            background: #08080d;
            overflow: hidden;
        }
        .panel-center canvas {
            display: block;
        }

        /* View tabs */
        .view-tabs {
            position: absolute;
            top: 10px;
            left: 10px;
            display: flex;
            gap: 4px;
            z-index: 10;
        }
        .view-tabs button {
            padding: 4px 12px;
            font-size: 11px;
            background: #1a1a2ecc;
            border: 1px solid #2a2a3e;
            color: #888;
            cursor: pointer;
            border-radius: 3px;
            font-family: inherit;
            backdrop-filter: blur(4px);
        }
        .view-tabs button.active {
            background: #ff6b3540;
            border-color: #ff6b35;
            color: #ff6b35;
        }

        /* Map container */
        #map-container {
            width: 100%;
            height: 100%;
            display: none;
        }

        /* Right panel — leaks */
        .panel-right {
            background: #0d0d14;
            border-left: 1px solid #1a1a2e;
            overflow-y: auto;
            padding: 12px;
        }
        .panel-right h3 {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #e63946;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .panel-right h3::before {
            content: "⚠";
        }

        .leak-section { margin-bottom: 16px; }
        .leak-card {
            background: #1a1a2e;
            border: 1px solid #2a2a3e;
            border-radius: 4px;
            padding: 8px;
            margin-bottom: 6px;
            font-size: 10px;
        }
        .leak-card.critical {
            border-color: #e6394640;
            background: #e6394610;
        }
        .leak-card .label {
            color: #e63946;
            font-weight: bold;
            font-size: 9px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }
        .leak-card .detail { color: #aaa; line-height: 1.5; }
        .leak-card .detail strong { color: #e0e0e0; }
        .leak-card .metric {
            display: inline-block;
            background: #ff6b3520;
            color: #ff6b35;
            padding: 1px 5px;
            border-radius: 2px;
            font-size: 9px;
            margin-top: 3px;
        }

        /* Peer info tooltip */
        .tooltip {
            display: none;
            position: absolute;
            background: #1a1a2eee;
            border: 1px solid #ff6b3540;
            border-radius: 4px;
            padding: 8px 10px;
            font-size: 10px;
            z-index: 100;
            pointer-events: none;
            max-width: 280px;
            backdrop-filter: blur(8px);
        }
        .tooltip .alias { color: #ff6b35; font-weight: bold; font-size: 11px; }
        .tooltip .pubkey { color: #666; font-size: 9px; word-break: break-all; }
        .tooltip .ip-info { color: #e63946; margin-top: 4px; }
        .tooltip .score-info { color: #aaa; margin-top: 4px; }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: #0a0a0f; }
        ::-webkit-scrollbar-thumb { background: #2a2a3e; border-radius: 2px; }
    </style>
</head>
<body>

<div class="header">
    <h1>GOSSIP TOMOGRAPHY <span>// LN Privacy Leak Detector</span></h1>
    <div class="stats">
        <span><span class="val" id="stat-peers">—</span> peers</span>
        <span><span class="val" id="stat-msgs">—</span> messages</span>
        <span><span class="val" id="stat-ips">—</span> geolocated</span>
        <span><span class="val" id="stat-leaks">—</span> leaks found</span>
    </div>
</div>

<div class="main">
    <!-- Left panel -->
    <div class="panel-left">
        <h3>Message Picker</h3>
        <div class="msg-filter">
            <button class="active" data-type="all">All</button>
            <button data-type="channel_announcement">Chan Ann</button>
            <button data-type="node_announcement">Node Ann</button>
            <button data-type="channel_update">Chan Upd</button>
        </div>
        <div class="msg-list" id="msg-list"></div>

        <h3>Playback</h3>
        <div class="playback">
            <div class="time-display" id="time-display">0.000s</div>
            <div class="controls">
                <button id="btn-play">▶ Play</button>
                <button class="secondary" id="btn-reset">↺ Reset</button>
            </div>
            <label>Speed: <span id="speed-label">1×</span></label>
            <input type="range" id="speed-slider" min="0.1" max="10" step="0.1" value="1">
            <div class="progress-bar"><div class="fill" id="progress-fill"></div></div>
        </div>

        <h3>Communities</h3>
        <div class="community-legend" id="community-legend"></div>
    </div>

    <!-- Center -->
    <div class="panel-center">
        <div class="view-tabs">
            <button class="active" data-view="radial">Radial</button>
            <button data-view="map">World Map</button>
        </div>
        <canvas id="viz-canvas"></canvas>
        <div id="map-container"></div>
    </div>

    <!-- Right panel -->
    <div class="panel-right">
        <h3>Privacy Leaks Detected</h3>
        <div class="leak-section" id="leak-first-responders">
            <div style="color:#888;font-size:10px;margin-bottom:8px;">
                <strong style="color:#e63946;">Surveillance Suspects</strong> — Peers that are
                abnormally fast at relaying gossip. They're either topologically central
                or running monitoring infrastructure.
            </div>
        </div>
        <div class="leak-section" id="leak-colocation">
            <div style="color:#888;font-size:10px;margin-bottom:8px;">
                <strong style="color:#e63946;">Co-location Detected</strong> — Peers sharing
                the same /24 IP subnet. Likely same data center or operator.
            </div>
        </div>
    </div>
</div>

<div class="tooltip" id="tooltip"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="app.js"></script>
</body>
</html>
